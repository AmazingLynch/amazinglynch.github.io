{"componentChunkName":"component---src-templates-blog-post-js","path":"/pnpm-monorepo/","result":{"data":{"site":{"siteMetadata":{"title":"Colgin's Blog"}},"markdownRemark":{"id":"bbfbebdd-310b-55d6-8403-8df686922a28","excerpt":"pnpm 作为一款与 ,  类似的依赖管理工具，对 monorepo 也提供了非常好的支持，针对使用 workspace 的问题给出了非常优雅的解决方案。本文将从三个方面对此做简单介绍： workspace 语法 pnpm 的 stream，parallel 参数 filter 过滤语法 workspace…","html":"<p>pnpm 作为一款与 <code class=\"language-text\">npm</code>, <code class=\"language-text\">yarn</code> 类似的依赖管理工具，对 monorepo 也提供了非常好的支持，针对使用<code class=\"language-text\">yarn</code> workspace 的问题给出了非常优雅的解决方案。本文将从三个方面对此做简单介绍：</p>\n<ul>\n<li>workspace 语法</li>\n<li>pnpm 的 stream，parallel 参数</li>\n<li>filter 过滤语法</li>\n</ul>\n<h2>workspace 语法</h2>\n<p>不知道读者们有没有使用 <code class=\"language-text\">yarn workspace</code> 的经验；如果有两个子包 foo, bar, 想要将 bar 作为项目依赖加到 foo 中，可能你会在 bash 中执行<code class=\"language-text\">yarn workspace foo add bar</code>。</p>\n<p><code class=\"language-text\">yarn</code> 可能会从远程仓库中拉取 bar 包，这就与我们想要的有点不一样了。不过可以通过指定固定的版本号来让 <code class=\"language-text\">yarn</code> 将本地的 bar 包作为 foo 的依赖</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> workspace foo <span class=\"token function\">add</span> bar@0.1.2 <span class=\"token comment\"># 具体的版本号需要看bar包的package.json#version</span></code></pre></div>\n<p>这就给使用者带来了迷惑和不确定性，pnpm 引入了 <code class=\"language-text\">workspace</code> 语法，特指本地包，具体的可以查看 <a href=\"https://pnpm.io/zh/workspaces\">pnpm workspace</a>。</p>\n<p>现在我们通过命令 <code class=\"language-text\">pnpm -F foo add bar</code> 为 foo 添加 bar 为项目依赖，可以看到 foo 的 package.json#dependencies 中</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"bar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:^1.0.0\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>不过需要注意的是 <code class=\"language-text\">workspace</code> 仅仅是 pnpm 支持，因为在 <code class=\"language-text\">pnpm run publish</code> 或者 <code class=\"language-text\">pnpm run pack</code> 的时候，<code class=\"language-text\">pnpm</code> 会自动将 <code class=\"language-text\">workspace</code> 语法 转化为标准的版本号。</p>\n<p>比如</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"foo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:*\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"bar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:~\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"qar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:^\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"zoo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:^1.5.0\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>会被转化为</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"foo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"bar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~1.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"qar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"zoo\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.5.0\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>pnpm stream &#x26; parallel</h2>\n<p>我们搭建以下的测试环境</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> packages\n\t<span class=\"token punctuation\">-</span> foo\n\t<span class=\"token punctuation\">-</span> bar\n\t<span class=\"token punctuation\">-</span> alice\npackage.json\npnpm<span class=\"token punctuation\">-</span>lock.yaml\npnpm<span class=\"token punctuation\">-</span>workspace.yaml</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">packages</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">-</span> <span class=\"token string\">'packages/*'</span></code></pre></div>\n<p>foo, bar, alice 是三个子包， 每个子包都是用 tsup 进行打包。然后，在根 package.json 中，需要 一个命令对所有子包进行构建</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"script\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\tbuild<span class=\"token operator\">:</span> <span class=\"token string\">\"pnpm -r run build\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里有一个需要注意的是，一定要加 <code class=\"language-text\">-r</code></p>\n<blockquote>\n<p>—recursive -r\n这会从每一个  <code class=\"language-text\">package</code>的“ scripts”对象中执行任意一个命令。 如果一个  <code class=\"language-text\">package</code>没有该命令，就会被跳过。 如果所有  <code class=\"language-text\">package</code>都没有这个命令，则会执行失败。</p>\n</blockquote>\n<p>如果不加 <code class=\"language-text\">-r</code>的话，会只运行当前 package.json 的 build，其实是没有的，自己运行自己，会进入死循环；</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a820148af960c271caeb12e96230b71/0b6f4/no-r.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYElEQVQ4y41U2XLbMBDTDyS6b/HQbTvpZKb//2/oYEnKsuu0ecBwuSRXBBZUVJQNyqpBVXeomx5NO6DtBjRtf+TqJqz1x9gwX3du9KjqFtHl+oGvr98YpxXzsmGeNxgzwY4LlLbQZsI4LpLjHsaE5KcFxs5yRs7ZCREPbvsV/WBkUZsRWV4J8qJGVlTH/L8oKkRl1aIoaxRF5VDWUog4x8+gVK/y0TjOWJYV1pLajGmaZSS0MjBmlNgKtdXHk0gwzatgWXcsyw47zoj2/YrPz19QyviNIyo2qWpQlrWMtY/L4s4kz0vJsTFdr9APGm2nELHQNM4YBg2tLbpuQByniONMxvf3BG9vAfGBkOf4HqdI08JRbmgJ3qJu3S1OOHQtzvG/EW3rjtvtA8ZYp6OdoLUR9F0PNSiJ1aBFDuoqa70SmUKeYE6asm8XtG0ni30/CA1Hm0iekHopnBwOsUeCiOJmWYE8LxDie7Hvir4q7AvymtbTFNqkxReirdxWSbMMlNLHGvdxbvw+nreB8rpuuF5vaNteEkSwixvrBwudcW4k59KUwd+QduHXaB/SDkjTHEmS/QXmCdI+W8nZpm7lr+HiAH7d/4mCscNYPtoozNmDaF13XC43abtoYefDBrwtraFFM/Oo4aGtyx+2maZFClJDLjJJGoFanGQPL+eVA+72SRBl3irOOozL+2Yp9l2hJ3jvRrwZaSh5Hda9Bo5iG+WpPVKWuc9r+amMskaJomXZhDIbwk53bX8InT+90yD+q6ZIjk0JxmbBwT+9QCNJfkj3hIiH6KHwq6IWr3z3U/wBmeMxLoQstF8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm run build\"\n        title=\"pnpm run build\"\n        src=\"/static/5a820148af960c271caeb12e96230b71/f058b/no-r.png\"\n        srcset=\"/static/5a820148af960c271caeb12e96230b71/c26ae/no-r.png 158w,\n/static/5a820148af960c271caeb12e96230b71/6bdcf/no-r.png 315w,\n/static/5a820148af960c271caeb12e96230b71/f058b/no-r.png 630w,\n/static/5a820148af960c271caeb12e96230b71/40601/no-r.png 945w,\n/static/5a820148af960c271caeb12e96230b71/0b6f4/no-r.png 984w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>加上 <code class=\"language-text\">-r</code> 之后，当前找不到，就会去 workspace 中找 build 命令。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/084bc9b802ebb9b008be4e3a914eb4c9/7ae9c/r.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150.63291139240508%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABYlAAAWJQFJUiTwAAADxklEQVRIx41V2ZKjRhDkecMhCaEDEEef0DRoDs84/OII//9XpSMLoWtmd/2QUdCtTiqrsktJearRtBqHY4m6UfKcFyds0h3S7R7pdodtdvjfSJpGozw1yIsKp6pFXSto41E3GtxrlZWPkXw5lO2OPyeM8YzX13d0/YDOB/i3P+HeP+F9D+t6aONgrIdSFkVZo22NRFnTTtapjGv7Q4Gk9xFDnOB8QAgjxvMblPGSETMmASN/vNvnD/GGXNaIJLgR0/mMGKMQxjgJnOsxTa94e/+QLClzOXTD8YInwhA6hM4KSUep1qOuW5FN8NCeOMwkWXZ4yjK/oEDidY+u6zHGEdP0gmk8wxgnpEOIeHl5Q5GX2LLb2x02m+2MNBNikrBph2OxEAaE3uEcmU2QjLS2ONFOjZK4Wm2wXqffguTb7V4yJnHSmQDnvGREMtVq7HZ7HChvd5C4IMvmdcrn3tf9w0xobYvQaTjfCzlLYIxF3weRfTwWV8kL0jQTZNn8zo8x28RWHoOOsK1HrwJc63E45sjzEm2rsN8fsF5vsBF5XyXP5dhcy5L0bsDH+IlgA5yNaKZ3VEqjqVvkeYGqqqGUlueyPAmqqoFSRpxQ142UgGvMNNHKwjoHbSyc94jjiLpqkG62F5Lq2t00vccseZEvnWeGtmFDnPiv6wK8664ZeN9hHCfJYCbMHnCzUXYlTZzqxTbT0KHvB8RhxBgnscwwRHm/bwqLfw+SLPYhcRLsIAf7LgghQfswS2bMa8hsn7O7yrwHJcfujPM0YIqdGDuEOPtRGTjrxeT3h9frheDS6dVjTFRlRJ40x3q0rZ6v1Dfmze6e5/2b0Zc6J1Z10KaGdy00Z5wxcK4TYzNSdlGchJg1Wz601HB5p1/ZfTF21BO86hHNiGAGFOUJx2MpQ4IZ/Owe34w9R8nQtA6Tf4FtHIzqUYUziroRL7K7p7ISA/OZt4egN5umlcFBMMvTxa8JGzDEKF70fY/4+gYljdjKQZJR8rNlpL6XyD1GNi/h3aWBSciudq6DNU6uGK1ET5J08dqv5D8YO/bzxCY5bws7z66zjg+D9TcQ2yg9e45EJGQ9WBt6kEannNtt+BVSJKYhkZYMtXYil5AM+Rdq3Jdufje+ZqRIdG1lPGkOA/pPWxmaS/Hngs9+4/OjD3cPF2CWXFs0qoIzDbR1aEmu7Xx79DxxaJl7cmIZFsv7TJgi8XWHofHoGoOesXU4VbO/SEbr8Ms3qc9/WE+S87LG8PEv2vMn9MvfmP76R0rw48cfWK3WgltD0t/iP4uPDkp7ScaDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r run build\"\n        title=\"pnpm -r run build\"\n        src=\"/static/084bc9b802ebb9b008be4e3a914eb4c9/f058b/r.png\"\n        srcset=\"/static/084bc9b802ebb9b008be4e3a914eb4c9/c26ae/r.png 158w,\n/static/084bc9b802ebb9b008be4e3a914eb4c9/6bdcf/r.png 315w,\n/static/084bc9b802ebb9b008be4e3a914eb4c9/f058b/r.png 630w,\n/static/084bc9b802ebb9b008be4e3a914eb4c9/40601/r.png 945w,\n/static/084bc9b802ebb9b008be4e3a914eb4c9/7ae9c/r.png 972w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n可以看到是一个包一个包构建的；</p>\n<p>现在三个包都是相互独立的，可以运行 <code class=\"language-text\">pnpm -r --stream run build</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5cdae8a58aae9a701d4c372909d71b16/416ee/stream.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD1ElEQVQ4y41Ua5OjNhDkc5I1YN4SQkgCATaPtb3O7SX//3d1agbbe5eqpO5Dlx4ltXpmehSksoL6/Bvq23eoz79Q3z8R+hSpLdAoC9d5yFojjBLExwxRnCI+/oh974lAygZt00LXDVqlYbSB0R1041CrFrXS0K1jtKaDdR7GdjtMx/vW9bC2h3MewTCesW4XSL7c8gHV7ESK9mqNSiiUVY2KINQD+7p87Am5I6DLfT8gz0sURQWtDRNKUmwchGw4rCQtfgkBSW2IQCooUtW06DoPazvUdcNj21pkecmPEtI0R5LmyPMKeSF28LxCIJYV4npFOo7Ieg/hR5hlg/UjHOfJwbQW1jhUlUSWFRCiZlKOhnKsLUdDoQejOeMy3eGEhypbFMah1JYvE0iR4HxJJilLwaS0lqLmNc1ppHwHW3/FWJ+hMweRaeTGotSGD0tZPw42fClJMl4T8b8Jn3uBbFek4ozD0SBKG+Qk3dgvwqJC0+hXmD9epof2c+qVisC4FaUYEcUNjkmNXLfIpEJVCj4gKHSeSxTF7gRWxyQ5wjBGGEY8RtERwdtxwVt6R5huiLIB9e0OeZrhrONqj+OEwQ88UnHKokRdK3g/sN1U3UCpBnGcMGkQZTPC/IIwnRFnPeR2gRgmtLplgr730LrlKpNCUhHHRyRJiizNkaYFh/tFmKwIkzvC44qYFF4/IMYTetezqtPpzD4kRRQuhUeke6jxY35EFCdMGoTdirfpA4duQdgOKJcN6v0K03n4nkI+YRpPHD55jvJKxSB/0kO0JtIngqraIOUdsrpAiAnN7U+oeUXnevhhwjBMTOZczwrJl0/L0JxUHQ4Rgwm74QP99B2mu0DaM6rtinq7QLueSU+nGd6PTEwglaTQ93tRqNoEeoRzGE8Lou2GeJoRuQH5NDNhTT2sDYZh5H4mhdRqx2PK2LtFsE8pbDI9E56zBdf8hi3b0GcD5OUGMZ25qkRExdjHkS8SGYW697BhC5F1KHQOWdgFjf9AbVfk7YBi2SCXDc3jU5imM7pu/5FoTV3yrDDl7WnsV1F+n8/47XYFjX/0Hulwgny/on7kkKpM4RIoV8+L8cMmz/mLsHQzqvGKyi3I9YBiXiHXd6jWvhRyLv3IhIdDjDhKfrLKT7Z5T2Z8S264JRuG1HMOq2FiY3Nl6X80lq1Dhfgvohehzc7wxQUum6GyHmJ9Z0IqClmDQqW5btpXZ/wvYR3P0PEVKl5QJZ7zR73sqVP8yAWhKlNFf4mw8ivkfAeNmfHI54U/iMZ26FyHkdTSvOvZLs+O+EKMKHwgivEPwjuZBEYC2ywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r --stream run build\"\n        title=\"pnpm -r --stream run build\"\n        src=\"/static/5cdae8a58aae9a701d4c372909d71b16/f058b/stream.png\"\n        srcset=\"/static/5cdae8a58aae9a701d4c372909d71b16/c26ae/stream.png 158w,\n/static/5cdae8a58aae9a701d4c372909d71b16/6bdcf/stream.png 315w,\n/static/5cdae8a58aae9a701d4c372909d71b16/f058b/stream.png 630w,\n/static/5cdae8a58aae9a701d4c372909d71b16/416ee/stream.png 930w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>—stream\n以起始<code class=\"language-text\">package</code>目录作为前缀，立即从子进程输出流。 这允许从不同的  <code class=\"language-text\">package</code>交替输出</p>\n</blockquote>\n<p>可以看到三个 包 顺序交替；</p>\n<p>再运行一下 <code class=\"language-text\">pnpm -r --parallel run build</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/88be65850c0d1a827c9b11aabc0d9099/f1901/parallel.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 134.17721518987344%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAABYlAAAWJQFJUiTwAAAENklEQVRIx31VyZbbOAzUPWnL2hdKFDdRm+W10+75/w+reYBsp5PJ5IBHWjKKQFWBCrKmQfP+CXF5R3P7QLUesbMRclmjbTW06ZHlFfZRiijO/jee74O6btFJhU5qdJ2G6gy6zqLrDEQj0bQKnTKQnYE2Dlo7KO34facsBz83PT8PlsMRh/WMqm7REqC2aKVmIFpbqUCHlqVAVTePaFFWAmXVcNDvWkjeB3S6sT2yrOSKlLJomo7/RFURYJIVSNJn5H/Y5699YKxH23Zo2o6TqUI/TLDWMwXW0XuFNCuZy7yoH+vP/dcImssF1e2G2DkkxqL2I7r5AG0drCGuFLQ2vK8qASFaXquq4c465rZniiiCRR9wtGeYwqKtFMreo5Yaom5QE1+VQNtIlGWNLCtQFBXSNH8B16Jlqmgl+oJjf4UXM7rcoS4VCtejkuqVQEBNI5HnJfKsQFlugPRsq1TwIfSeKAukPiMtF4SRQpxJlARInAqqkBJq5viZRAdsgO0vFNBhtA/a9YjEDwhbibBpkUqFTCoUVb2BNRLiAU4UPEEpmQ6JogRhuMd+H3MEvThh1neM4gwpJ4jPTzTTwiJ4P2CaZozjhGVeoJTmIeDfywqlDJIkQ5KkCMMI+32E4JSu+JFecYpXmLKHeH9HrS1Mp2GMg3M9rHUw2qDIS8RxgqIomUPyK61U6W633wCFXSGHGxq9INcDqvMFYlpYMWMsV0mrVoaTqZo4Tpk3+RCPOCZeqcrgbTnh++UH3oYFOzegOl0g1hM6bbnt6dl+P2zV5OUv6hIQtU2H7KMEQZQeEWXviJIDsnpE9/kP2n6Edx7ejxiGCYMfMY7zqyLnPPNIlJBQ5M+t5RhBWl4RV3fE+RFZM0N+3NH4EVZbTuz7kVcaQ5r3KEq5KlK6KmteSflNlBhBfLwivN6xHxeE/YjqdIVYz9DWM9BhWaGpfR4zzYDhPmYAquoZL9uEy4rd9R37cUbYDyjXE2rikBX23Kp57IkrSiLvveIB9BNQrAjlDWG5IGo8xO0HhJ9YVaqKOJTsvfnR2ga4/w3oBfg9PuFb8oFv0YKoHCHvn6itx/QQYgMdUVeC2/wbGAOqbIUtrtDpAXXlN2NbD6MMXE+iDDwhBExifG35j4CX5Ih7esM1PsKVA8THHcL2GPuB2yVAZ3tu+5n0FOSp7C+ArVqh7A2tXJB3nielHiYobRiIKiNTk8IkCgERl2Ry8t/voMHbcsD3yxVvw4g326NYVlTLioZmWWk46+Dss3WzfRZszxNEJv9qmZ+2udwQDhN2zqMg2xxWSPq2WIXBaTg3sHV65xmEHLAsBx69/1S4OxzZh+E44+0BWB2O0OTBYdqmxXlM48zfl7aVUJ3GPB+YiiendNPs6XLYjTN2xzNC57HTFvm0oBwnSLVV6IzcPu58nVlWnASig543zP5L/AtevNCvciZ0gAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r --parallel\"\n        title=\"pnpm -r --parallel\"\n        src=\"/static/88be65850c0d1a827c9b11aabc0d9099/f058b/parallel.png\"\n        srcset=\"/static/88be65850c0d1a827c9b11aabc0d9099/c26ae/parallel.png 158w,\n/static/88be65850c0d1a827c9b11aabc0d9099/6bdcf/parallel.png 315w,\n/static/88be65850c0d1a827c9b11aabc0d9099/f058b/parallel.png 630w,\n/static/88be65850c0d1a827c9b11aabc0d9099/f1901/parallel.png 942w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>—parallel\n完全忽略并发和拓扑排序，在所有匹配的包中立即运行给定的脚本 并输出前缀流。 这是个推荐的标志，用于在许多  <code class=\"language-text\">packages</code>上长时间运行的进程，例如冗长的构建进程。</p>\n</blockquote>\n<p>可以看到 如果子包没有依赖关系的话，这个和 stream 效果是一样的</p>\n<p>现在我们给子包加上依赖关系，运行 <code class=\"language-text\">pnpm -F alice add bar</code> 让 alice 包依赖 bar 包。再运行 <code class=\"language-text\">pnpm -r run build</code>, 可以看到</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db0ba365667cbe8e009e7e1741bde598/587b0/dep-r.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 151.26582278481013%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD+ElEQVRIx4VU15LjRgzks+1aMecwnMygdFe+uv//sXYBFClpd20/oCZI7EGjGwiKosYwSORFhbrp0bYDmqZHFGeI4hRhlPI+TvK3iBK62yM/9sEgJMSoGaTrBTohoayH0hZCKBjj0fUjkrRAmpVH5Hl17Om3PQLjJqzrFdO0QhsHef8Jc7lBK4tBKI5RGrSdYAYETquUhpmJUT3uBaq6Q2DlhGle4fwKYz3O5xusnZhmWbUMRh9t2RRvGb1mvEfgxIx5WbEuE7yfMc8rluUMPy2c9e32kx/KHhSzvOQ9rd8DjjOcc5idhjEOznpobdG2PYSQ/EhVNUjT/AFScPEpww24Oh6gNTC9g9Ia52Xhj8/rBUppGG1hjcP1esMwjAjDGDGpHsZHkAvoAXJIXtS8BnbwsNbisjiunTEW46hYdcqMMg3DBB8fIU6n6JuIEUUpkjRn5RlQKg0lt6wouzwvP0WFsmqQJBmfi6JCRgIxyHamoDMDKqMwWcE1pAytdZCjgtEG3nkURYkoSr4E037s93IEY6UwiwVu8NCdgRMbQJ4VaNsOVVkjDCOEp2hbH/V7Ug7f1oCoXuc7ZjtDDhpivaOzDkM/oKpqDjGMaJoWZVkdj1Cdu25A3wumW9ct0w+U0NDGQGkDKRWmeWbbEA36Q98P/OeNWvwSX+kzZbLNPC9Y5xnWeizzCu8mzoBqeb//YPtQjT4DbXfPWoZRgkB3FlprTFZCa8cgJAxREWJkoYq8OgAoSO0tcr4/nZ61DUgEApgm6piJW486hDJUynAbEvjpYeTPFN+CRKFeNtbgslgeVQSqeXRJLjqBUqud+KOvQJ+NHoy1QtttfSul5sxyNu5juuzmLes3Ix/GptZ7NACVI1CthTQSVnfQdutrEocyc85jWdZjOFDdaN33BLCfKeI4QSAqCTdMcOME1Rl4OaMsa+RZyZQJbKfzSvE7ylunCIWLvcIIB9VpiNGjsB5tP6KpWwanATH0gmk1TceU+W4QaJvuuEvTDIEUGsZaOD+xwc/XK5RxrCR1CWVJf949F78ovdkoYfp8t/dy1/fQahOEJk7XdpwRZUAzkjqFxtd/KXz4UDYaWivMbmS7UFeQuXdjr+uZaX/ru28iUK1mY1Nm1MsERgrXdcNWorbU2nzpiH8H7Cy8d1j91hlaGV4JrH8YmyyxT2xat/37ef+djU0ThQYqjbJ9YpNiT49lLAwVnwy9m/r1TMHGZkDRQ8kGoyLbjCzOJsoI76cDbFM05Qd2tem8GT7jaRSo2mAaHHxvoFuJSTj2FSlLrUi0wwe152QOP03s512Q5jnU+gvj+W/0yw/Y+28s5wv+/OMvfJyoNqcXMaL/jX8AY2kPgBjUBb4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r run build\"\n        title=\"pnpm -r run build\"\n        src=\"/static/db0ba365667cbe8e009e7e1741bde598/f058b/dep-r.png\"\n        srcset=\"/static/db0ba365667cbe8e009e7e1741bde598/c26ae/dep-r.png 158w,\n/static/db0ba365667cbe8e009e7e1741bde598/6bdcf/dep-r.png 315w,\n/static/db0ba365667cbe8e009e7e1741bde598/f058b/dep-r.png 630w,\n/static/db0ba365667cbe8e009e7e1741bde598/40601/dep-r.png 945w,\n/static/db0ba365667cbe8e009e7e1741bde598/587b0/dep-r.png 970w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>可以看到 只加了 <code class=\"language-text\">-r</code> 参数的话，pnpm 会自动分析 依赖拓扑，先构建 bar，而且每个包的输出都有有顺序的。\n再 运行 <code class=\"language-text\">pnpm -r --stream run build</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3e2242525f625ff8af813e8a42198f0/c6ff8/dep-stream.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 156.96202531645568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEPElEQVRIx31W2XarOBD0c66XmMWAWAQCgYRNbMdJZub/P6zmVNv4OMlNHnQQJCpVV1d3e5FEMbIkQbjdIoljpEmCOI6RpSmCIMBqtcJms7mv9Xp9X1+/PT8/Y5G3LWJdYVdVyKoKddehaRqUZQnTNMjzHNvtFlEUyQW8jPv5PQxD7HY7eSf4ojAHlN0RqvJQfoL55wNd18F2nTydc8iVQl3XKIoCfd/L97Zt5bKqquC9R9e2V8C86FFWI1TWIjU9Uu+EHVkaY2TxEA+TMYHSNJXwyPzxKSEn7oR0/4bYHqCmE4rXV9RNg95aYcfbrbVIkkQu4l5rDaWUhP+opTBMqg5JPWCXGyTGInUORVFCV5UcnNnxdmpGdlmWQWXZXbeZnTD02RFTfoGNHbQ7Qp1Pohd1GvpeQmT4DIuATACZ8RkGwXfAP6PD08sBT25A5D3U4YDGGAlZdGwaCe8n2xDkEXQRtx67fkKkLZLeQe33olVrjAByMcSvTOb1jeE5fMFb9IqXjYcZTlCXs4Q7jtdkkCkveBT+b8zugLnqUBYDsrRB2nRIhl78pnUtQNST5mXFMNNcP4EJ4PJ8xp+PDzy9TNidz6guF9R1g8Ea7EeP0Y9XIxuD0Xux0SPLb4DrzmI9OKzaFpG1yLwXdm1TwZhGGNI+zKxkn6Uax78wnA4Qlt4j3u+RT5NkmQyt7URHe6tvgpHtbOi/AppyQqdPaDKP0r0gP5+k3Hpr4NyAYRiEITM9g/8a8rC1GAMHu6lR0DpDD6Vy6Eqhaep7tcwJ4vtPYFfb7M54Sz8wBXu0/oL8/SJMRtdj9A7jOF47Tp5LQqZpkvL7MeRh28EHPeymuTJ0g2S5M+yHNapKo9ZaaptlSJbBX0pufl+01RF9/QatPEp/vGs49J0kgf0ve2hXXF87zCeGOh9Qlx5V1iHvHLLRi7GpGfUiIzaC2dTcM+S5SXDPrkPz832RlBpJ1WBXVMi0Rqq1/HOWKdFtPswGwUVQfueef+PzEyDNHA0Dwq6DGgbkrF3qdTM2mc6MKQUZE4Q2Inh6G2bzfFksbYelc1i2rYBmzqHSGo1WaG+VQtsQlEkpi+Kbhp869j47YcrfMEQetTshfz3DmBbO1mIb765dh+xoG17wqw+V7pE3HlnRIeuZlBFNfW2qDIP6MLMMh3seYud5bLJ8zvN7ke/2KJMjsrBHUjqo4xHGWlRlieiWRWn3t/lL4XkZ9/M8pp5M1FXDYMIyPGG5HbEOLYq3d1RugG1bqWPvnFQKLcRFX7KNFXku83q+aE7OYh1YrEOH9dZgE2qkfhT7FEoJwFzDPMSQyGj2JNfjnJGQV+EZq+gdq2DCJvYo//0P2jsM1uJwONyn3ww4A/zUcRbroMM66D8xVHUt024Ok/rMIAzx8ZfCt6m3CicIy8BjE1mo1wvKW9+jXciOWs5epJ6s8Z+G1P8ntCkqhPSONQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r --stream run build\"\n        title=\"pnpm -r --stream run build\"\n        src=\"/static/c3e2242525f625ff8af813e8a42198f0/f058b/dep-stream.png\"\n        srcset=\"/static/c3e2242525f625ff8af813e8a42198f0/c26ae/dep-stream.png 158w,\n/static/c3e2242525f625ff8af813e8a42198f0/6bdcf/dep-stream.png 315w,\n/static/c3e2242525f625ff8af813e8a42198f0/f058b/dep-stream.png 630w,\n/static/c3e2242525f625ff8af813e8a42198f0/40601/dep-stream.png 945w,\n/static/c3e2242525f625ff8af813e8a42198f0/c6ff8/dep-stream.png 1088w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>可以看到 <code class=\"language-text\">--stream</code> 只是 让不同子包的输入会交错，实际的打包顺序还是严格按照拓扑关系来的，在这里先打包 bar, foo, 再打包 alice。</p>\n<p>再运行 <code class=\"language-text\">pnpm -r --parallel run build</code>, 这个偶尔出错，因为有时候 bob 比 alice 包先打包完，则不会报错；否则就会报错。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c2fdc715e0d1c1458b7daa13cc367a2/48ca3/dep-parallel-success.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.77215189873417%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAABYlAAAWJQFJUiTwAAADvklEQVRIx41V2XKrOhDk3WATwiIQmwRa2GzsLOf/v6xvjWx8fJI4dR+mJCi76ZlutTyWpGBpijiKkGcZWJYhiWNkWebqcDhgv99/W7d6fKa9x7VC0jZI6gpZXaPue0ilUFcV2rZFURSI4xhRFLn19fXVfYj2SZK497TSO9p7orlAtG+o+Aw2LBB/PqGHAVopKKUwTROaunbgdV3DWotxHGGMce+ojsuCYRiugIdQ4xAa7A8d4kaiMNqxI5D6BsQYAy8KcM4h2hZ5nt9Zpmnq3tMzte2J5B0i/UT1egQfV/B1Rdd1jgnVPE2wxqAsS8d6WRa0TXNvf5sdVRiG8PzIwI8s/EghFj0YMbwxIzZN0zhG9GNqiRixm2D0vAFROVFYdwLrV6SVQaIt8mVBJSQ6KdH3vZsjMaa2S87dnj5GQry8vNwBN5bekp1wZCtsMqK0C4rjEVJ2UDcwWqlFao/apNapA5opsX1keG150PBHA78XOLQtMm2Qty2qsnTt0p9ppT8TI1qLPHeMqTZ2d8Cg+kBQfyJgJ6TTEeXlgl5rJwRZQWsNIcS31h7rEdTbhRq70MAPyeAdmFIOQEqJ6mbur8P/Wv8wnJMzlvQCEw2ozIx8mSGFdMz0TRAC/v+A6YwlnWFig1KPYNPo1CUweVOaxKD5PQP5R5RgHLGfJgR9h5DsMY7gUkK2rWO3eZJAH0PgGagXzBcEyxsCNSEaJxTnM+QwYLTW2YaEIUDf9+9H7beZen6o4ZMoh/4uijNv0zi7kEDOd5zfR7Cd2x8BWXIBS96RRgvy4WpsawcMuoU12qUKFQlDQhFrMvlThlM8YI5H2FcF3llk1sBog06SdYRjSyyJIQEarX9nOCcLluQIHSlwNYCNg2utExX6rrsC3oJ2y8TfLORd4hVv8RlLNKG2RxTHxYEY3cEY7SKMGNI8aT9Y+5SdA+SlBq8MWC6QtBKZUuB0fqvcgVDQilu6bCx/VXn38Y7d5yd284xwmsDfP9AMA1QnMdge0zS7uZG69IF1XV0+BjeW39JmrzT22mAvJEIhkFE60+xEi7apXLtkoS1hKDRIoOfGXlcE5zMCaxEag/x0Qm0MrO6hegGtjbMKMaTWt+vgKeCeH7HnJwRsQmJGJ4p0wdrBqOvdUlWla5PClkT5Kbb+zvDFYPcyYBf+PSkUrm1dQIjrnbLZhexE7f+qMovfweIPZNEJxXhCeT67kzFa5cQgRsSOTgcp/XhKfgpbr2g0isYg4wKxkE6UigJWSNR14+ZGgfD1unzG8D+YJtt/tNu4SwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r --parallel run build\"\n        title=\"pnpm -r --parallel run build\"\n        src=\"/static/9c2fdc715e0d1c1458b7daa13cc367a2/f058b/dep-parallel-success.png\"\n        srcset=\"/static/9c2fdc715e0d1c1458b7daa13cc367a2/c26ae/dep-parallel-success.png 158w,\n/static/9c2fdc715e0d1c1458b7daa13cc367a2/6bdcf/dep-parallel-success.png 315w,\n/static/9c2fdc715e0d1c1458b7daa13cc367a2/f058b/dep-parallel-success.png 630w,\n/static/9c2fdc715e0d1c1458b7daa13cc367a2/40601/dep-parallel-success.png 945w,\n/static/9c2fdc715e0d1c1458b7daa13cc367a2/48ca3/dep-parallel-success.png 1084w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>可以看到 ，如果 alice 比 bar 先打包就会报错\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b135c31623dc268c1006badc39903e7c/f3a19/dep-parallel-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 130.37974683544306%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAD2UlEQVRIx3VVya7cNhDULR74eaiNpESRIkVR28yz3wIHAXLNIYf8RHKxgyzI/58qaI44lh3kUGiyJZaqNypz4gVj8wOG8gnd+gL9/UcM3mNdFoQQcLlcIKUEYwxFUSDP8/8FPc/eOo+3YQbZwjqobUPb9+iUglIKzjk0TRNJ27a9r+kZ5zz6aF9VFeq6RjaKHkvjMXEL0zu0g4MQIr7Y9308SHuy5FP7hwhEnojLsrwRtmKCkiuUmND5BWqe0XUdtNaw1kZSIjLGRB89ozVZ8pOPiAikNCsbg6KxIMs7A+ksJClp23iIVBBSuIREltJAZPeQ6zBCbAvEFCC9h15W8K6DFCIeoHCSpdAJRJr2RJLWRJqdvQebF7AxILcW7eUCrjWqsvyKLJEkHxFRZSl3VF0CrTMeJlTzjNqPEMMAs1dZcH7PG4HWlM9jDpNNKaACZfm6gl2vYOuKYgwwr6+Q1qEsikiQiOjlI2n6EKlNqSD1GRvHSEb2rA3ksqJSCjlj96QTQeo5Cl3s+U3PU0vFKtdhgrxcUHmPs1KQIaBqmkgopLxX+Nt8HomTQkJWa41Ca7wTAoxzVKpDuTdqdWgHstG32+Q7IhaFbRfkT0/Itw35OEK/vKAdBjRSQmtzD4nyR5aaPRXiWBRa3xq778HHEXwYUFNV5xmKfHUdCXSn0BGUuh+Ofq3vU5TaKYZcWos6BJTOgVMfjiNkLEKNliZHGYhWQ7bdf2aZ9mks08xnVAy5baB+bEKA3jYo59BKgc5N4HaDsCsaO8eDab5TSyUfKb4pNAakkmylNVrvIfb5bBsJ1Ug0kqNrm/vYHVvmeKWRzfg0o54XyGWBHEfYx8c4KbEosZFttHQvkpKkkGyapONEZbXtUTsL4R1Eb9CFgNYYtHv/pXzFPtynIak63uBpnZ3MBafhGW/UinfjCvn8jMYNcK6DHSyk6tBpfa8iqTifz3h4eIiWfg1HZG5e4dYrxmXFsq64fniPx3nCyxzwIXgsuoO3FGKPnkLvb7bbq0wzT1NF6hgp/I2f8A//Dp/4G3wWJ3yu3+B3fsInfsIf4oS/mgd85AVsXcITeAUvOTSv4eoKXcFg8zNUzsBzhmwpGB4LhpAziHinFaiLHHVR3FHQHy/efUUMK4Wa7yhyUnhDxsoJ53pDWQTUboG8XqB7B+cMnB/QuwHa9FBaYxiGWGG2F4IlsC/IfuITfqkW/MwGXFxAt87wxmAdDLbRYx1HTMOA0BtM3sd2iWR73vKDuqjw1+aMPx8H/P3o8eM64vX9FUHU6PIzdJHDlDmanKEvbik579X8mvQL/gXWLKRWGdoeIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pnpm -r --parallel run build\"\n        title=\"pnpm -r --parallel run build\"\n        src=\"/static/b135c31623dc268c1006badc39903e7c/f058b/dep-parallel-error.png\"\n        srcset=\"/static/b135c31623dc268c1006badc39903e7c/c26ae/dep-parallel-error.png 158w,\n/static/b135c31623dc268c1006badc39903e7c/6bdcf/dep-parallel-error.png 315w,\n/static/b135c31623dc268c1006badc39903e7c/f058b/dep-parallel-error.png 630w,\n/static/b135c31623dc268c1006badc39903e7c/40601/dep-parallel-error.png 945w,\n/static/b135c31623dc268c1006badc39903e7c/f3a19/dep-parallel-error.png 1086w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>-F —filter 与 workspace</h2>\n<p>在 <a href=\"https://pnpm.io/zh/filtering\">pnpm 过滤</a> 中 有 一部分过滤器 是专门设计给 workspace 使用的。</p>\n<ul>\n<li><code class=\"language-text\">--filter pkg... run test</code> 会将 pkg 包和 pkg 所有的依赖包进行 测试</li>\n<li><code class=\"language-text\">--filter pkg^... run test</code> 会运行 所有 pkg 包的依赖项的测试</li>\n<li><code class=\"language-text\">--filter ...pkg run test</code> 会运行 pkg 包以及依赖它的所有包的测试</li>\n<li><code class=\"language-text\">--filter ...^pkg run test</code> 会运行所有依赖 pkg 包的测试</li>\n</ul>\n<p>在我们的场景中，alice 包 依赖 bar 包， 所以</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">pnpm</span> -F alice<span class=\"token punctuation\">..</span>. run build <span class=\"token comment\"># 构建 alice 包 和 bar 包</span>\n<span class=\"token function\">pnpm</span> -F alice^<span class=\"token punctuation\">..</span>. run build <span class=\"token comment\"># 构建 bar 包</span>\n<span class=\"token function\">pnpm</span> -F <span class=\"token punctuation\">..</span>.bar run build <span class=\"token comment\"># 构建 bar和 alice 包</span>\n<span class=\"token function\">pnpm</span> -F <span class=\"token punctuation\">..</span>.^bar run build <span class=\"token comment\"># 构建 alice包</span></code></pre></div>\n<p>利用过滤器可以让工作流更加优雅。</p>\n<p>以上便是 monorepo 在 包管理器 pnpm 中的使用。可以在 <a href=\"https://github.com/colgin/pnpm-monorepo-demo\">github</a> 找到文中的代码 demo。 不过需要强调的是 monorepo 还有许许多多的工程问题，本文都没有涉及，这个留到以后再讲。</p>","frontmatter":{"title":"pnpm与monorepo","date":"November 06, 2022","description":"pnpm中的monorepo简单优雅"}},"previous":{"fields":{"slug":"/tailwind/"},"frontmatter":{"title":"谈tailwindcss"}},"next":{"fields":{"slug":"/better-fetch/"},"frontmatter":{"title":"更好用的fetch"}}},"pageContext":{"id":"bbfbebdd-310b-55d6-8403-8df686922a28","previousPostId":"a0014f68-9955-57d6-a0af-b672bd03f461","nextPostId":"f63ec00c-d3a8-53f0-981d-942e203c0def"}},"staticQueryHashes":["2841359383","965855181"]}